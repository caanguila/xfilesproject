<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">

    <ui:composition template="../../templates/creatively-cabinet.xhtml">

        <ui:param name="pageTitle" value="Home / File Download"/>
        <ui:param name="webSiteTitle" value="X Files"/>

        <ui:define name="submenu">
        </ui:define>

        <ui:define name="content">
            <h:form id="create_request_form">    
                <h:panelGroup id="request_download_controls" rendered="#{downloadRequestBean.fileExists()}">
                    <h:panelGrid columns="2">
                        <h:outputText value="Password" rendered="#{downloadRequestBean.passwordNeeded}"/>
                        <h:inputSecret value="#{downloadRequestBean.key}" rendered="#{downloadRequestBean.passwordNeeded}"/>

                        <h:commandLink id="request_download_btn" actionListener="#{downloadRequestBean.createRequest}" 
                                       class="button_green" value="Request Download" 
                                       onclick="$('#request_download_controls').css('display', 'none');">
                            <f:ajax execute=":create_request_form requests" />
                        </h:commandLink>
                    </h:panelGrid>
                </h:panelGroup>
                <p></p>
                <h3>All your download requests:</h3>
                <h:panelGroup id="requests">
                    <table class="table table-striped">
                        <tr>
                            <th># ID</th>
                            <th>File ID</th>
                            <th>Date Requested</th>
                            <th>Date Provided</th>
                            <th>Status</th>
                            <th>Link</th>
                        </tr>
                        <ui:repeat value="#{downloadRequestBean.downloadRequests}" var="downloadRequest">
                            <tr>
                                <td style="text-align: center;">#{downloadRequest.id}</td>
                                <td style="text-align: center;">#{downloadRequest.file.fileId}</td>
                                <td>#{downloadRequest.dateRequested}</td>
                                <td>#{downloadRequest.dateProvided}</td>
                                <td style="text-align: center;">#{downloadRequest.status}</td>
                                <td>
                                    <a href="#{request.contextPath}/download?id=#{downloadRequest.id}">Download</a>
                                </td>
                            </tr>
                        </ui:repeat>
                    </table>
                </h:panelGroup>
            </h:form>

        </ui:define>

    </ui:composition>

</html>